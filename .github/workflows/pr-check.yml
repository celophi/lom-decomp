name: Quick Check (PRs)

# This is a faster workflow for pull requests that only checks if the build works
# The full progress report is only generated on pushes to main

on:
  pull_request:
    branches: [ main, master ]

jobs:
  quick-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Build Docker image
        run: docker build -t lom-decomp .
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install Python dependencies
        run: pip install -r requirements.txt
      
      - name: Run splat split
        run: python3 -m splat split config/SLUS_010.13.yaml --make-full-disasm-for-code
      
      - name: Build project
        run: docker run --rm -v ${{ github.workspace }}:/lom lom-decomp make all
      
      - name: Verify build output
        run: |
          if [ ! -f "build/slus_010.13.elf" ]; then
            echo "Error: Build did not produce expected ELF file"
            exit 1
          fi
          echo "âœ“ Build successful!"
          ls -lh build/slus_010.13.elf
